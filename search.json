[{"title":"Ptrade无法发送企业微信消息","path":"/ptrade/wffsqywx/","content":"Ptrade无法发送企业微信消息问题使用Ptrade内置的send_qywx函数向自己的企业微信账号发送消息，Ptrade终端显示“企业微信消息发送成功”，但实际上企业微信收不到消息。 （相关链接：API文档 - send_qywx发送企业微信信息） 原因经过测试了三家券商，都存在前述问题。推测应该是send_qywx函数已经和现在的企业微信不兼容了。 解决方法一、自己写代码替代send_qywx 1、获取Ptrade服务器的IP地址 新建一个策略，写入如下代码，记得将Corpid、Secret、Agentid替换成你自己的。 （相关链接：企业自建应用） 默认打开的代码折叠框123456789101112131415161718192021222324252627282930313233import requests, json, datetimedef initialize(context): #初始化模块，每次启动策略时触发执行一次 passdef before_trading_start(context, data): #每个交易日开盘前触发执行一次 Content = str(datetime.datetime.now()) # 消息内容，可随意替换 Status = SendMessage(msg) #运行SendMessage函数 print(Status) #显示SendMessage函数返回的结果def SendMessage(msg): #生成Token Corpid = &#x27;替换为你的企业ID&#x27; Secret = &#x27;替换为你的自建应用密钥&#x27; Agentid = &#x27;替换为你的自建应用Agentid&#x27; Url = &quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken&quot; Data = &#123;&quot;corpid&quot;: Corpid, &quot;corpsecret&quot;: Secret&#125; r = requests.get(url=Url, params=Data, verify=False) #print(r.json()) if r.json()[&#x27;errcode&#x27;] != 0: return False else: Token = r.json()[&#x27;access_token&#x27;] Partyid = &#x27;1&#x27; #部门id，根据你的实际情况替换 Subject = &#x27;企业自建应用消息测试&#x27; # 消息标题，可随意替换 # 发送消息 Url = &quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=%s&quot; % Token Data = &#123;&quot;toparty&quot;: Partyid, &quot;msgtype&quot;: &quot;text&quot;, &quot;agentid&quot;: Agentid, &quot;text&quot;: &#123;&quot;content&quot;: Subject + &#x27; &#x27; + msg&#125;, &quot;safe&quot;: &quot;0&quot;&#125; r = requests.post(url=Url, data=json.dumps(Data), verify=False) return r.json() 运行这个策略，Ptrade终端会显示如下报错信息。这表明Ptrade服务器与企业微信服务器的通信正常，但是Ptrade服务器的IP不在企业微信服务器的白名单内，被企业微信拒绝了。记住这个红框内的字符串，它就是Ptrade服务器的IP地址，后边会用到。 2、设置可信域名 在电脑浏览器中登录企业微信的管理后台，依次点击“应用”-你用于发送通知的自建应用，进入自建应用的管理界面。我们的目的是将Ptrade服务器的IP地址添加入“企业可信IP”名单中。 如果直接点击“企业可信IP”的“配置”，会提示“请先设置可信域名”，所以需要先设置可信域名。（相关阅读：企业内部开发配置域名指引） 如果你没有自己的域名，可以随便找一个免费的虚拟主机、函数计算应用，一般都会自带二级或多级域名，只要域名没有被企业微信屏蔽就可以用。因为免费服务不稳定，资源有时效性，所以阿猪不打算专门写教程，具体方法请大家自行百度。 3、设置可信IP 可信域名设置成功后，就可以继续设置可信IP了。点击“企业可信IP”中的“配置”，然后将前边得到的Ptrade服务器IP复制进来，再点击“确定”就可以了。 在阿猪测试的三家券商中，有两家添加可信IP后就可以正常从Ptrade发送企业微信消息了，有一家添加可信IP时提示“IP属于第三方服务商”，无法在自建应用中使用。对于后者，从技术层面讲是可以解决的，但是在操作层面涉及到券商的配合问题，可行性较差。而且我们的主要目的是用策略赚钱，而不是搞技术研究，所以不再深入讨论，感兴趣的读者可以参考企业可信IP配置指引自行研究。 img 4、在策略中加入消息发送模块 既然Ptrade内置的send_qywx函数已经失效，那我们就得自己写代码来替代。其实前边的代码就是一个完整的示例代码，只要替换成你的id和密钥就可以正常使用。 读者可以根据自己的需要在适当的时候调用SendMessage函数。例如我们想在下单后向企业微信发送成交结果，只需把成交结果作为参数传递给SendMessage函数就可以了。 二、使用替代方案如果嫌上边的方法麻烦，或者遇到券商的IP无法设为可信IP的情形，可以尝试下边的方法作为替代方案。 1、使用email （1）使用Ptrade内置的send_email函数 关于send_email函数的使用方法，读者可以参考API文档中的send_email - 发送邮箱信息。 （2）使用python内置的smtplib等模块 关于使用python内置模块实现发送email的方法，请读者先自行百度，后续阿猪会考虑在入门教程或者FAQ中专门写一篇文章来介绍。 2、使用企业微信的群机器人 是的，你没看错，又是通过企业微信。只不过这里不是使用企业自建应用发送消息，而是通过企业微信群的机器人来发送消息，“秘诀”就在于通过群机器人发送消息不受IP限制。 （1）创建一个企业微信群（2）添加一个群机器人 （3）获取token （4）在策略中加入消息发送模块","tags":["企业微信自动发送"],"categories":["Ptrade"]},{"title":"ptrade提示无可转债权限，如何解决？","path":"/ptrade/ptradekzzqx/","content":"提示【账户无可转债交易权限，无法进行对应类型交易】问题 我的证券账户已经开通了可转债交易权限，为什么使用Ptrade时仍然提示“账户无可转债交易权限，无法进行对应类型交易”？ 原因 这里的可转债交易权限指的是使用Ptrade进行可转债交易的权限，而不是你的证券账户的可转债交易权限。Ptrade中的可转债交易权限默认是关闭的。 解决方法 联系你的客户经理，让客户经理为你的Ptrade账号开通可转债交易权限。你可能需要配合填写一些申请材料，并签署一些知晓并愿意承担风险的书面文件。在你首次申请开通Ptrade时，申请材料中通常会要求你选择是否同时开通可转债交易权限。建议你一并开通，免去后续再次申请开通的麻烦。 扫码开通Ptrade需要开通Ptrade，欢迎扫码咨询 （备注：ptrade开通） 扫码咨询","tags":["开户"],"categories":["Ptrade"]},{"title":"Ptrade如何登录？","path":"/ptrade/ptraderhdl/","content":"Ptrade如何登录双击桌面的“PTrade交易系统”图标即可启动Ptrade客户端。 首次运行Ptrade时，一般会先运行自动更新程序，需要耐心等待片刻。 更新成功后，在登录界面中输入账号、密码，然后点击“登录”按钮即可登录Ptrade。 在券商开通Ptrade权限后，客户经理会提供软件和证券账户密码，而ptrade的登录账户和证券账户是一样的。 需要注意的地方1、首次使用生产客户端的量化功能时，如果是在非交易时段进行登录，则会提示“没有权限”（具体记不清了，欢迎大家截图反馈）。 这是因为Ptrade客户端在与服务器通讯时，会先核验本地的token。只有在交易时段进行一次登录，才会在本地生成token。token生成后，后续即可在非交易时段正常使用量化功能。 2、在收盘后登录时，Ptrade会提示“当前为系统清算时段…..”。无需在意这个提示，点击“是”即可继续正常使用。 扫码开通Ptrade需要开通Ptrade，欢迎扫码咨询 （备注：ptrade开通） 扫码咨询","tags":["Ptrade基本操作"],"categories":["Ptrade"]},{"title":"Ptrade软件界面基本操作教程","path":"/ptrade/ptradeuijs/","content":"Ptrade客户端包含行情、交易、工具、量化、日内五个功能模块 一、量化模块 本教程主要介绍量化模块的使用，它包含研究、回测、交易、帮助四个子模块。 1、研究模块 研究模块有两个子模块，一个是文件管理，一个是Jupyter。 undefined Jupyter是一个流行的交互式笔记本，用户可以直观的看到代码的运行结果，包括变量的计算结果、生成的图形等等。Ptrade客户端中集成了Jupyter的一些基本功能，方便用户进行策略研究和代码调试。 undefined 文件管理模块允许用户在服务器端创建、编辑、管理自己的文件。 该模块极大的提高了Ptrade的灵活性，例如：用户可以将数据提前保存到研究目录下，回测时直接从研究目录中读取，可以极大的提高回测速度；用户可以将研究目录作为“中转站”，实现跨策略交互数据；用户可以编写脚本定期将外网数据保存到本地，然后通过定时上传功能上传到服务器，间接实现Ptrade服务器与外网间的数据交互自动化。更多的妙用等待你来发现。 2、回测模块 回测模块主要用于策略的代码调试和回测。用户可以根据回测结果对策略进行分析和调整。 3、交易模块 如果你对策略在回测模式下的运行结果感到满意，那么可以考虑在交易模式下运行该策略。交易模式下运行的策略将会产生真实的交易。 交易模块支持同时运行多个策略。 4、帮助 这里可以查看完整的API文档。 二、其他模块 除了主打的量化功能，Ptrade还提供行情浏览、手工交易等功能。由于这些不是本教程的侧重点，所以后续不再过多介绍，感兴趣的读者可以自行研究。 1、行情模块 用户可以在这里浏览股票的分时图、K线图、F10信息等，可以进行简单的自选股管理。 img 2、交易模块 用户可以在这里进行手工下单、查看持仓信息、资金信息、委托信息、成交记录等。 img 3、工具模块 这里集成了一些主流的手工交易工具，例如网格交易、算法交易等等。 img 4、日内模块 这里提供了几种快速手工下单的工具。 img 低门槛开通Ptrade需要开通Ptrade，欢迎扫码咨询 （备注：ptrade开通） 扫码咨询","tags":["开户"],"categories":["Ptrade"]},{"title":"ptrade开通门槛，哪些券商支持ptrade？","path":"/ptrade/smsptrade/","content":"什么是Ptrade？有哪些券商支持Ptrade？Ptrade是恒生电子（马云控股）开发的，券商采购的正规量化交易软件。一般个人散户也可以使用。Ptrade的研发团队相对于QMT，更为成熟，文档更为细致人性化，视频教程也相对较多。 Ptrade是部署在券商机房，你把程序写好之后，保存好之后就可以点击运行，无论回测，还是实盘，最终实在券商的服务器上运行的，程序里面返回的结果是从远程返回来的，如果用过优矿，米矿等量化平台的朋友，对这种模式一定很熟悉，相对与本地运行，ptrade可以做到无人值守7x24小时稳定运行 大体上来讲，各家券商提供的Ptrade功能都是差不多，研发团队实力强的获取的历史行情数据完整性会更好。如果恒生电子加入新的接口函数，研发实力强的券商会很快就把新接口加入到他们券商的Ptrade里面。 不过笔者看来，这并不是好事，频繁改动API参数或者加入新特性，会对线上已经运行的策略造成冲突不兼容。 Ptrade界面 市面上的券商支持QMT的要比Ptrade要多一些，或者QMT和Ptrade同时都支持。目前同时支持Ptrade和QMT的券商有国盛证券，国金证券； 而单独只有Ptrade的，目前来看只有湘财证券，东莞证券. 和QMT一样，Ptrade的开通门槛不同的券商的门槛不一样。笔者接触过市面上大部分的Ptrade券商，从经验上看，头部券商的Ptrade门槛很高，基本都要求合格投资者证（资产300W以上证明），然后要求证券账户资产达到300W以上，才能申请Ptrade。比如银河证券要求合格投资者证明和资产300W。 实际市场上大部分散户投资者的资产在50W以下。 投资者资产分布 所以笔者认为不要迷信大券商，大券商不一定见的适合你。它们本身因为严格的合规问题，比如银河证券QMT，需要部署到它们的券商机房，不允许客户在本地电脑执行，第三方库需要添加白名单才能安装，宛如带着手链跳舞。所以规模大的头部券商也有它们的难处，而中小规模的券商则可以很灵活地根据政策即使调整，满足市场不同的需求。 笔者这里提供的市面所有的Ptrade券商开户渠道。 是的，没错，只要券商本身提供Ptrade功能的，都可以联系我来开通。 下表是平时开的比较多的券商营业部的开通门槛和详细费率。门槛见最右一列。 Ptrade开通门槛与费率券商开通QMT门槛与费率 PS: 费率可能会有所变动，具体以咨询为准 上表的部分券商也可以选择开通QMT，由北京迅投技术有限公司开发的量化交易软件。 注意，上图里面有国金1，国金2这样的，属于不同的地区营业部，因为门槛和费率这块国金下面的营业部可以自主调整，所以和笔者合作的部分营业部会有低门槛的优惠政策。 上表中Ptrade开通门槛最低的是国金3，只需要开户后入金2W，就可以申请开通Ptrade。 而国金的股票一般都是开通时不免五，要等到开户后半年之后，即时资产达到50W，可以调整免五。 然后是东莞证券的Ptrade，它的开通门槛是入金30W。一般情况入金就可以开通，不需要购买理财或者股票之类。 因为Ptrade是部署在券商的机房，所以大部分券商为了数据安全，不允许Ptrade和外部进行通信，也就是Ptrade所处的环境是券商的局域网，内部提供基础的行情实时数据，历史数据，财务数据，市场各种各样的指标数据。它的内置基本可以满足80%的需求。 如果遇到内置数据不满足的情况下，可以通过上传文件（excel，txt，csv各种格式都可以）的方式，把数据导入到Ptrade里面。 如果要获取实时的数据，手动上传肯定是不满足的。那么上表里面有个券商 国盛证券，它是唯一一个可以有外部网络访问功能，也就是它可以连接外部网络，比如它可以连接外部的mysql数据库，或者实时爬虫，抓取同花顺，东方财富的数据。 Ptrade的默认获取行情数据是是支持十档委托。注意，这里是获取十档委托，可以看到更多的委托订单。 不过这个并不是实际的传统的逐笔成交L2数据。市面上有些经理把它叫作L2，其实这个说法是不准确的。 十档行情 Ptrade里面只能获取到委托的数量，而看不到每一笔里面是分了几个人挂单。总体来说，Ptrade还是相当容易上手的。 大体情况是这样，主要还是根据用户自身的资金体量来选择券商，门槛和者费率。如果资金充裕的，可以把免五也开了，其他就差不多了。开通后也会提供相应的Ptrade代码指导与修改。Ptrade而言相比QMT入门要简单很多，文档结构清晰，尤其细节方面写的面面俱到，输入输出都有示例代码。 当然，开通后遇到任何问题可以提供咨询解答服务 扫码开通Ptrade需要开通Ptrade，欢迎扫码咨询 （备注：ptrade开通） 扫码咨询","tags":["开户"],"categories":["Ptrade"]},{"title":"QMT开通门槛，支持哪些券商？","path":"/qmt/smsqmt/","content":"什么是QMT？有哪些券商支持QMT？QMT是迅投公司开发的，券商采购的正规量化交易软件。一般个人散户也可以使用。 大体上来讲，各家券商提供的QMT功能都是差不多，大同小异，最大的不同可能是某些券商加入个别的功能限制。 QMT界面 市面上越来越多的券商也支持QMT。不同的券商的门槛不一样。笔者接触过市面上大部分的QMT券商，从经验上看，头部券商的QMT门槛很高，基本都要求合格投资者证（资产300W以上证明），然后要求证券账户资产达到300W以上，才能申请QMT。比如银河证券，广发证券，华泰证券，均要求合格投资者证明和资产300W。 实际市场上大部分散户投资者的资产在50W以下。 投资者资产分布 所以笔者认为不要迷信大券商，大券商不一定见的适合你。它们本身因为严格的合规问题，比如银河证券QMT，需要部署到它们的券商机房，不允许客户在本地电脑执行，第三方库需要添加白名单才能安装，宛如带着手链跳舞。所以规模大的头部券商也有它们的难处，而中小规模的券商则可以很灵活地根据政策即使调整，满足市场不同的需求。 笔者这里提供的市面所有的QMT券商开户渠道。 是的，没错，只要券商本身提供QMT功能的，都可以联系我来开通。 下表是平时开的比较多的券商营业部的开通门槛和详细费率。门槛见最右一列。 QMT开通门槛与费率券商开通QMT门槛与费率 上表的部分券商也可以选择开通Ptrade，由恒生电子开发的量化交易软件。 注意，上图里面有国金1，国金2这样的，属于不同的地区营业部，因为门槛和费率这块国金下面的营业部可以自主调整，所以和笔者合作的部分营业部会有低门槛的优惠政策。 上表中QMT开通门槛最低的是国金3，只需要开户后入金2W，就可以申请开通QMT。 而国金的股票一般都是开通时不免五，要等到开户后半年之后，即时资产达到50W，可以调整免五。 然后是国信证券的QMT，它们对QMT做了一定的修改，改动的地方比较多，主要是界面方面。它们的量化量化软件也叫iQuant。 国信iquant 国信证券是所有券商里面投入到QMT研发资源最多的。它们家的官网有对QMT很多详细的资料，还有视频，文档，比其他几家券商的资料要丰富，而且它们的技术支持团队也是比较强大的。 在上面表格里面，只有国信证券能够支持L2数据的接入。L2数据是逐笔交易数据，在主推模式下，只要来了一笔成交，它就会把bar数据推送给QMT，所以在1秒内如果有大量的订单成交，必然会造成网络拥堵。所以它的订阅模式下也有股票数目的限制，目前只能订阅500个股票。 L2数据是从交易所获取的，因此需要缴纳一笔费用给交易所，券商只是帮忙搭个线，协助你开通L2。 不过客观说，国信也有不足的地方，就是它的miniQMT需要申请才能开通，不像国金证券，开通了QMT之后miniQMT直接就可以使用的了。 而且国信的miniQMT只能拉取行情，无法进行交易，它的下单权限需要机构才能够申请。 安信证券的QMT，也叫ACT，当然功能其实差不多，改动的大部分是外观UI层面的，添加了一些自定义的按钮。 底层写量化策略的API函数和接口基本都是一样的。毕竟那个才是核心，所以核心的交易下单接口，拉取行情接口这种全部券商都是一致的，没有哪家会贸然动底层的东西。 另外QMT也支持期货，期权的量化交易。可以添加文末我的微信，找我申请，就可以安排工作人员开通QMT上的期货，期权的量化交易权限了。 大体情况是这样，主要还是根据用户自身的资金体量来选择券商，门槛和者费率。如果资金充裕的，可以把免五也开了，其他就差不多了。开通后也会提供相应的QMT代码指导与修改。 QMT入门会有一定的使用门槛，即使是多年经验的程序员，如果没有有经验的人指导与帮助，十有八九会被它的文档带入坑里面的（反正笔者我已经从坑里爬出来几次了 扫码开通QMT需要开通QMT，欢迎扫码咨询 （备注：qmt开通） 扫码咨询","tags":["开户"],"categories":["QMT"]},{"path":"/baidu_verify_codeva-3TCWb5aj6X.html","content":"249a0e4bcdc558400194629571f2a1c9"},{"title":"关于我","path":"/about/index.html","content":"简介多年基金从业经验的宝妈，熟练使用QMT，miniQMT，Ptrade，掘金量化等市面常用的量化软件，常用编程语言python。 熟练在不同的量化软件之间切换；也熟知每一个软件的优缺点。 金融证券领域已经见过不少风风浪浪，经验可谓不少。 证券从业资格和基金从业资格考试 从业资格证 对于基本的证券规则与常识，熟练掌握。所以在证券相关领域的商务合作上值得信赖。 证券低佣开户目前已和各大券商合作，推出低费率开户服务，以及开通Ptrade，QMT，miniQMT，iquant，掘金等量化软件接口（国金证券，国盛证券，国信证券，安信证券，东莞证券，国元证券，银河证券）。 需要的朋友，可以关注公众号：量化低费率， 咨询开通。 每个券商的门槛不一样，但我可以保证，该券商的门槛是市面上最低且费率是最优惠的。I promissed 当然也有很多非量化的低费率券商，万一免五 。 商务合作有合作意向可添加文末的微信二维码，记得添加备注：商务合作。 喜欢和性格耿直坦率的朋友同事合作。欢迎真诚的您！ 公众号量化低费率 扫码关注","categories":[null]},{"title":"朋友","path":"/friends/index.html","content":"朋友占位符"},{"title":"^^更多^^","path":"/more/index.html","content":"^^更多^^的占位符"},{"title":"^^随记^^","path":"/notes/index.html","content":"^^随记^^占位符"}]